<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="UTF-8">
  <title>Eindopdracht</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <script src="js/aframe.min.js"></script>
</head>

<body>
  <a-scene stats >
    <a-camera></a-camera>

    <a-entity class="parent" position="0 0 0">
      <!--<a-entity class="box" geometry="primitive: box" material="color: red" position="-5 0 0"></a-entity>
      <a-entity class="box" geometry="primitive: box" material="color: green" position="5 0 0"></a-entity>
      <a-entity class="box" geometry="primitive: box" material="color: yellow" position="0 0 5"></a-entity>
      <a-entity class="box" geometry="primitive: box" material="color: blue" position="0 0 -5"></a-entity>-->

    </a-entity>
    <a-plane position="0 -1 0" rotation="-90 0 0" width="200" height="200" color="#7BC8A4"></a-plane>

    <a-sky color="#555"></a-sky>

  </a-scene>


  <script type="text/javascript">
    let positionX = 0;
    let positionY = 1;
    let positionZ = 0;

    const init = () => {
      for (var i = 0; i < 50; i++) {
        generateNewBox();
      }

      //zorg ervoor dat je jezelf kan voorbereiden
      setTimeout(() => {
        update();
      }, 5000);
    }

    let counter = 0;
    let dead = false;
    const parent = document.querySelectorAll('.parent');

    const update = () => {
      generateNewBox();

      const changes = calculateMovement();
      document.querySelectorAll('a-box').forEach(box=>{
        const position = box.getAttribute('position');
        if(position){
          const boxChange = calculateBoxChange(box.classList[0]);
          box.setAttribute('position', `${position.x + boxChange.xChange + changes.xChange} ${positionY} ${position.z + boxChange.zChange + changes.zChange}`);
          if(position.x > 50 || position.z > 50 || position.x < -50 || position.z < -50){
            box.parentNode.removeChild(box);
          }

          if(position.x < 1 && position.x > -1 && position.z < 1 && position.z > -1){
            console.log('collison');
            dead = true;
          }
        }
      });

      if(dead === false){
        requestAnimationFrame(update);
      }
    }

    const generateNewBox = () => {
      const box = document.createElement('a-box');
      box.setAttribute('color', `blue`);
      const direction = Math.floor(Math.random()*360);
      box.classList.add(direction);


      const position = Math.floor(Math.random()*4);
      if(position === 0){
        box.setAttribute('position', `50 0 ${(Math.random()*100)-50}`);
      }else if(position === 1){
        box.setAttribute('position', `-50 0 ${(Math.random()*100)-50}`);
      }else if(position === 2){
        box.setAttribute('position', `${(Math.random()*100)-50} 0 -50`);
      }else{
        box.setAttribute('position', `${(Math.random()*100)-50} 0 50`);
      }

      document.querySelector('.parent').appendChild(box);
    }

    const calculateBoxChange = direction => {

      const speed = 0.1;

      let xChange = 0;
      let zChange = 0;

      if(direction === 0){
        //Z++
        zChange = speed;
        //X0
      }else if(direction < 90){
        //Z++
        zChange = (90-direction)/90*speed
        //X++
        xChange = direction/90*speed
      }else if(direction === 90){
        //Z0
        //X++
        xChange = speed;
      }else if(direction < 180){
        //Z--
        zChange = -((direction-90)/90*speed)
        //X++
        xChange = (Math.abs(direction-180))/90*speed
      }else if(direction === 180){
        //Z--
        zChange = -speed;
        //X0
      }else if(direction < 270){
        //Z--
        zChange = -((270-direction)/90*speed)
        //X--
        xChange = -((direction-180)/90*speed)
      }else if(direction === 270){
        //Z0
        //X--
        xChange = -speed;
      }else if(direction < 360){
        //Z++
        zChange = (direction-270)/90*speed
        //X--
        xChange = -((360-direction)/90*speed)
      }

      return {
        "xChange": xChange,
        "zChange": zChange
      };
    }

    const calculateMovement = () => {
      const cameraPosition = document.querySelector('a-camera').components.rotation.data;
      const cameraPositionY = Math.floor(Math.abs(cameraPosition.y % 360));

      const speed = 0.3;

      let xChange = 0;
      let zChange = 0;

      if(cameraPositionY === 0){
        //Z++
        zChange = speed;
        //X0
      }else if(cameraPositionY < 90){
        //Z++
        zChange = (90-cameraPositionY)/90*speed
        //X++
        xChange = cameraPositionY/90*speed
      }else if(cameraPositionY === 90){
        //Z0
        //X++
        xChange = speed;
      }else if(cameraPositionY < 180){
        //Z--
        zChange = -((cameraPositionY-90)/90*speed)
        //X++
        xChange = (Math.abs(cameraPositionY-180))/90*speed
      }else if(cameraPositionY === 180){
        //Z--
        zChange = -speed;
        //X0
      }else if(cameraPositionY < 270){
        //Z--
        zChange = -((270-cameraPositionY)/90*speed)
        //X--
        xChange = -((cameraPositionY-180)/90*speed)
      }else if(cameraPositionY === 270){
        //Z0
        //X--
        xChange = -speed;
      }else if(cameraPositionY < 360){
        //Z++
        zChange = (cameraPositionY-270)/90*speed
        //X--
        xChange = -((360-cameraPositionY)/90*speed)
      }

      return {
        "xChange": xChange,
        "zChange": zChange
      };
    }

    init();

  </script>
</body>

</html>
