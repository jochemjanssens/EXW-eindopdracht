<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="UTF-8">
  <title>Eindopdracht</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <script src="js/aframe.min.js"></script>
</head>

<body>
  <a-scene stats>
    <a-camera></a-camera>
    <a-entity class="parent" position="0 0 0">
      <!--<a-entity class="box" geometry="primitive: box" material="color: red" position="-5 0 0"></a-entity>
      <a-entity class="box" geometry="primitive: box" material="color: green" position="5 0 0"></a-entity>
      <a-entity class="box" geometry="primitive: box" material="color: yellow" position="0 0 5"></a-entity>
      <a-entity class="box" geometry="primitive: box" material="color: blue" position="0 0 -5"></a-entity>-->

    </a-entity>
  <!--  <a-plane position="0 -1 0" rotation="-90 0 0" width="1000" height="1000" color="#7BC8A4"></a-plane>-->

    <a-sky color="#444"></a-sky>

  </a-scene>


  <script type="text/javascript">
    let positionX = 0;
    let positionY = 1;
    let positionZ = 0;

    const init = () => {
      for (var i = 0; i < 50; i++) {
        generateNewBox();
      }

      //zorg ervoor dat je jezelf kan voorbereiden
      setTimeout(() => {
        update();
      }, 3000);
    }

    let counter = 0;
    let dead = false;
    const parent = document.querySelectorAll('.parent');

    const update = () => {
      generateNewBox();

      const changes = calculateMovement();

    //  const ground = document.querySelector('a-plane');
      //const groundposition = ground.getAttribute('position');
    //  ground.setAttribute('position', `0 ${groundposition.y - changes.yChange} 0`);

      document.querySelectorAll('a-sphere').forEach(box=>{
        const position = box.getAttribute('position');
        if(position){
          const boxChange = calculateBoxChange(box.classList[0]);
          box.setAttribute('position', `${position.x + boxChange.xChange + changes.xChange} ${position.y - changes.yChange} ${position.z + boxChange.zChange + changes.zChange}`);

          if(position.x > 100 || position.z > 100 || position.x < -100 || position.z < -100 || position.y > 100 || position.y < -100){
            box.parentNode.removeChild(box);
          }

          if(position.x < 1 && position.x > -1 && position.z < 1 && position.z > -1 && position.y < 1 && position.y > -1){
            console.log(box.classList[0]);
            dead = true;
          }
        }
      });

      if(dead === false){
        requestAnimationFrame(update);
      }
    }

    const generateNewBox = () => {
      const box = document.createElement('a-sphere');
      //box.setAttribute('color', `blue`);
      box.setAttribute('src', 'https://i.imgur.com/mYmmbrp.jpg');

      const direction = Math.floor(Math.random()*360);
      box.classList.add(direction);

      const height = Math.floor(Math.random()*200)-100;

      const size = Math.floor(Math.random()*2)+1;
      box.setAttribute('radius', size);

      const position = Math.floor(Math.random()*4);
      if(position === 0){
        box.setAttribute('position', `100 ${height} ${(Math.random()*200)-100}`);
      }else if(position === 1){
        box.setAttribute('position', `-100 ${height} ${(Math.random()*200)-100}`);
      }else if(position === 2){
        box.setAttribute('position', `${(Math.random()*200)-100} ${height} -100`);
      }else{
        box.setAttribute('position', `${(Math.random()*200)-100} ${height} 100`);
      }

      document.querySelector('.parent').appendChild(box);
    }

    const calculateBoxChange = direction => {

      const speed = 0.05;

      let xChange = 0;
      let zChange = 0;

      if(direction === 0){
        //Z++
        zChange = speed;
        //X0
      }else if(direction < 90){
        //Z++
        zChange = (90-direction)/90*speed
        //X++
        xChange = direction/90*speed
      }else if(direction === 90){
        //Z0
        //X++
        xChange = speed;
      }else if(direction < 180){
        //Z--
        zChange = -((direction-90)/90*speed)
        //X++
        xChange = (Math.abs(direction-180))/90*speed
      }else if(direction === 180){
        //Z--
        zChange = -speed;
        //X0
      }else if(direction < 270){
        //Z--
        zChange = -((270-direction)/90*speed)
        //X--
        xChange = -((direction-180)/90*speed)
      }else if(direction === 270){
        //Z0
        //X--
        xChange = -speed;
      }else if(direction < 360){
        //Z++
        zChange = (direction-270)/90*speed
        //X--
        xChange = -((360-direction)/90*speed)
      }

      return {
        "xChange": xChange,
        "zChange": zChange
      };
    }

    const calculateMovement = () => {
      const cameraPosition = document.querySelector('a-camera').components.rotation.data;
      const cameraPositionY = Math.floor(Math.abs(cameraPosition.y % 360));
      const cameraPositionX = Math.floor(cameraPosition.x%360);

      const speed = 0.2

      let xChange = 0;
      let zChange = 0;

      if(cameraPositionY === 0){
        //Z++
        zChange = speed;
        //X0
      }else if(cameraPositionY < 90){
        //Z++
        zChange = (90-cameraPositionY)/90*speed
        //X++
        xChange = cameraPositionY/90*speed
      }else if(cameraPositionY === 90){
        //Z0
        //X++
        xChange = speed;
      }else if(cameraPositionY < 180){
        //Z--
        zChange = -((cameraPositionY-90)/90*speed)
        //X++
        xChange = (Math.abs(cameraPositionY-180))/90*speed
      }else if(cameraPositionY === 180){
        //Z--
        zChange = -speed;
        //X0
      }else if(cameraPositionY < 270){
        //Z--
        zChange = -((270-cameraPositionY)/90*speed)
        //X--
        xChange = -((cameraPositionY-180)/90*speed)
      }else if(cameraPositionY === 270){
        //Z0
        //X--
        xChange = -speed;
      }else if(cameraPositionY < 360){
        //Z++
        zChange = (cameraPositionY-270)/90*speed
        //X--
        xChange = -((360-cameraPositionY)/90*speed)
      }

      const yChange = (cameraPositionX/90);

      return {
        "xChange": xChange,
        "zChange": zChange,
        "yChange": yChange
      };
    }

    init();

  </script>
</body>

</html>
